<% if (typeof popup !== 'undefined' && popup && popup.isActive) { %>
<!-- Popup Advertisement -->
<div id="popup-advertisement" class="popup-overlay" style="display: none;">
  <div class="popup-container">
    <div class="popup-content">
      <button class="popup-close" id="popup-close">
        <i class="fa-solid fa-times"></i>
      </button>

      <% if (popup.popupType === 'image' && popup.popupImage) { %>
        <!-- Image Popup -->
        <div class="popup-image-container">
          <% if (popup.redirectUrl) { %>
            <a href="<%= popup.redirectUrl %>" target="_blank" class="popup-link">
              <img src="/popups/<%= popup.popupImage %>" alt="<%= popup.popupTitle || 'Advertisement' %>" class="popup-image">
            </a>
          <% } else { %>
            <img src="/popups/<%= popup.popupImage %>" alt="<%= popup.popupTitle || 'Advertisement' %>" class="popup-image">
          <% } %>
        </div>
      <% } else if (popup.popupType === 'text') { %>
        <!-- Text Popup -->
        <div class="popup-text-container">
          <% if (popup.popupHeading) { %>
            <h2 class="popup-heading"><%= popup.popupHeading %></h2>
          <% } %>
          <% if (popup.popupDescription) { %>
            <div class="popup-description">
              <%= popup.popupDescription %>
            </div>
          <% } %>
          <% if (popup.redirectUrl) { %>
            <a href="<%= popup.redirectUrl %>" target="_blank" class="popup-button">
              <%= popup.buttonText || 'Learn More' %>
            </a>
          <% } %>
        </div>
      <% } %>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const popup = document.getElementById('popup-advertisement');
  const closeBtn = document.getElementById('popup-close');
  const popupShown = sessionStorage.getItem('popupShown');

  // Check if popup should be shown
  <% if (popup.showOncePerSession) { %>
    if (!popupShown) {
      // Show popup after delay
      setTimeout(() => {
        popup.style.display = 'flex';
        document.body.style.overflow = 'hidden'; // Prevent background scrolling
        sessionStorage.setItem('popupShown', 'true');
      }, <%= popup.displayDelay || 2000 %>);
    }
  <% } else { %>
    // Show popup after delay (every time)
    setTimeout(() => {
      popup.style.display = 'flex';
      document.body.style.overflow = 'hidden'; // Prevent background scrolling
    }, <%= popup.displayDelay || 2000 %>);
  <% } %>

  // Close popup functionality
  function closePopup() {
    popup.style.display = 'none';
    document.body.style.overflow = 'auto'; // Restore scrolling
  }

  // Close on X button click
  closeBtn.addEventListener('click', closePopup);

  // Close on overlay click (outside popup content)
  popup.addEventListener('click', function(e) {
    if (e.target === popup) {
      closePopup();
    }
  });

  // Close on Escape key
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && popup.style.display === 'flex') {
      closePopup();
    }
  });
});
</script>
<% } %>
